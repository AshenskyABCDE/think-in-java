# 消息队列

随着分布式和微服务系统的发展，消息队列在系统设计中有了更大的发挥空间，使用消息队列可以降低系统耦合性、实现任务异步、有效地进行流量削峰



## 如何保证消息不丢失

### 生产者确认机制

RabbitMq提供了publisher confirm机制来避免消息发送MQ过程中丢失

发送失败 回调方法即时重发，包存到数据库定时重发，然后删除

###  消息持久化

交换机持久化、队列持久化、消息持久化

### 消费者确认

消费者向交换机发送消息得到回应

## RabbitMq消息的重复消费问题

分布式唯一Id

乐观锁 悲观锁

## 死信队列

消息超时未消费，消息被拒、消息过期、队列满了的消息称为死信，会被重新发送到另一个交换机

## 解决RabbitMQ消息堆积问题

增加消费者

增加队列容量

利用线程池加快消息处理速度
