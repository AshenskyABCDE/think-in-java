# 内存篇

操作系统的内存分布：
1.用户空间和内核空间

32位下是1gb内核和3gb用户

64位下是128t和128t

2.用户空间

栈：局部变量和函数调用的上下文

文件映射区：包括动态库和共享内存

堆：动态分配的内存

BSS段：未初始化的静态变量和全局变量

数据段：初始化的静态变量和全局变量

代码段：包括可执行的二进制代码

3.内存紧张了怎么办

会通过内存交换技术，把不常用的内存暂时存放在磁盘，需要的时候再存放回内存

## 虚拟内存的作用：

1.可以允许访问进程内存大于物理内存的程序，原因是程序运行符合局部性原理，可以用到内存交换技术，根据访问对页进行置换，并且把不活跃的存放在磁盘上，使用时再存放回来。

局部性原理：

时间局限性：重复访问近期的数据

空间局部性：访问相邻的内存

2.可以让不同进程相互独立

3.可以对页进行标记，比如删除，读写权限等

## 内存分配

free释放内存

如果是brk，不会归还给操作系统

如果是mmap，会归还给操作系统，操作系统会真正的释放

mmap的坏处：会频繁进行运行态的切换

brk的坏处：可能会产生内存碎片，如果申请10，20，30。如果把10和20清楚，会存在内存碎片

## 缺页的内存分配

分为两种，一种是后台的异步回收，不会进行阻塞

还有一种是直接回收，会阻塞进程的执行

如果直接回收还是不行，会触发OOM

可回收的文件类型是文件页和匿名页

干净的文件页会直接释放，如果是脏页，就会先写回磁盘再释放

匿名页通过swap来换入到内存中

如何保证一个进程不被OOM杀掉：会根据一个OOM标准值进行计算，最大的进程会被杀死，因此我们可以调整这个进程的OOM标准值

## 在物理内存4GB上分配8GB内存会发生什么？

32位：用户虚拟内存只有3gb，因此分配不了

64位：能分配，但是得看有没有开启swap机制

如果开启了swap机制，进程就能正常运行



死锁的条件：

1.环路等待

2.互斥条件

3.持有并等待

4.不可剥夺



硬链接：多个项目录指向同一个文件，硬链接是不可用于跨文件系统

软链接：指的是具体的文件路径，可以跨平台



## 进程写文件的时候，进程发生了崩溃，写入的数据会丢失吗

答案是不会，数据其实写到内核的page cache中，内核会在合适的时候将其写到磁盘中，如果在写入磁盘中崩溃就会丢失。

当然也分进程崩溃和系统崩溃，如果只是进程崩溃，那么写入到内核的page cache就不会丢失，如果是系统崩溃，得写入磁盘才能保证数据不丢失